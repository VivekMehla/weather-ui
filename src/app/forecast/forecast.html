<div class="weather-dashboard p-card">
  <div class="current-section">
    <div class="main-temp">
      <i class="pi pi-moon" style="font-size: 2.5rem; vertical-align: middle;"></i>
      <span class="temp-big">{{ currentTemp !== null ? (currentTemp + '°') : '--' }}</span>
      <span class="unit">C</span>
    </div>
    <div class="weather-desc">{{ currentPrediction || '--' }}</div>
    <div class="minmax">
      {{ todayMaxTemp !== null ? (todayMaxTemp + '°') : '--' }}
      <span class="delimiter">/</span>
      {{ todayMinTemp !== null ? (todayMinTemp + '°') : '--' }}
    </div>
    <div class="location">
      {{ currentCity || 'Unknown city' }} · <span class="precise">Use precise location</span>
    </div>
    <div class="localtime">{{ currentDateTimeString }}</div>
  </div>

  <label for="city-input" style="font-size: 1.5rem; margin-bottom: 1rem;">Enter city:</label>
  <input
    id="city-input"
    type="text"
    list="city-list"
    [(ngModel)]="selectedCity"
    (keydown.enter)="fetchForecast()"
    placeholder="Type or select city"
    autocomplete="off"
    class="city-input"
  />
  <datalist id="city-list">
    <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
  </datalist>

  <button (click)="fetchForecast()" [disabled]="loading" class="search-button">
    {{ loading ? 'Loading...' : 'Search' }}
  </button>
  <div class="hint" style="opacity: 0.6; font-size: 0.9rem;">Press Enter or click Search</div>

  <div *ngIf="error" class="error-message">{{ error }}</div>

  <div class="week-row">
    <div
      class="day-forecast"
      *ngFor="let day of groupedForecast; let i = index"
      [ngClass]="{ active: i === selectedDayIndex }"
      (click)="toggleDay(i)"
    >
      <i class="pi pi-cloud" style="font-size: 1.7rem;"></i>
      <div class="day-label">{{ day.date | date: 'EEE' }}</div>
      <div class="day-temp">
        {{ getMaxTemp(day.hours) }}° <span>{{ getMinTemp(day.hours) }}°</span>
      </div>
    </div>
  </div>

  <div class="temp-curve-container" style="position: relative; width: 100%; max-width: 900px; margin: 0 auto;">
    <svg
      class="temp-curve"
      width="850"
      height="140"
      viewBox="0 0 850 140"
      xmlns="http://www.w3.org/2000/svg"
      style="display: block;"
      (mousemove)="onMouseMove($event)"
      (mouseleave)="onMouseLeave()"
    >
      <g
        class="y-axis"
        fill="#fff"
        font-size="12"
        font-family="Arial, sans-serif"
        text-anchor="end"
        opacity="0.7"
        transform="translate(45, 0)"
      >
        <ng-container *ngFor="let label of getYAxisLabels(); let i = index">
          <text x="-10" [attr.y]="20 + i * 25">{{ label }}°</text>
          <line
            x1="10"
            [attr.y1]="18 + i * 25"
            x2="805"
            [attr.y2]="18 + i * 25"
            stroke="#fff"
            stroke-opacity="0.15"
          ></line>
        </ng-container>
      </g>

      <polyline
        [attr.points]="getPolylinePoints(selectedDayHours, 805)"
        fill="none"
        stroke="#fff"
        stroke-width="3"
        transform="translate(45, 0)"
      />

      <!-- Transparent overlay rectangle to capture mouse events -->
      <rect
        x="45"
        y="0"
        [attr.width]="CURVE_WIDTH"
        height="130"
        fill="transparent"
        style="cursor: crosshair;"
      ></rect>
    </svg>

    <!-- Fixed time labels below graph -->
    <div
      class="curve-labels"
      style="
        margin-left: 45px;
        display: flex;
        justify-content: space-between;
        width: 805px;
        font-size: 1rem;
        color: #e2eafe;
        opacity: 0.8;
        position: relative;
        padding-top: 5px;
        box-sizing: border-box;
      "
    >
      <span style="flex: 1; text-align: center;">12 AM</span>
      <span style="flex: 1; text-align: center;">3 AM</span>
      <span style="flex: 1; text-align: center;">6 AM</span>
      <span style="flex: 1; text-align: center;">9 AM</span>
      <span style="flex: 1; text-align: center;">12 PM</span>
      <span style="flex: 1; text-align: center;">3 PM</span>
      <span style="flex: 1; text-align: center;">6 PM</span>
      <span style="flex: 1; text-align: center;">9 PM</span>
    </div>

    <!-- Tooltip displayed on hover -->
    <div
      *ngIf="tooltipVisible"
      class="tooltip"
      [ngStyle]="{ left: tooltipX + 'px', top: tooltipY + 'px' }"
    >
      {{ tooltipTime }} - {{ tooltipTemp }}°
    </div>
  </div>
</div>
